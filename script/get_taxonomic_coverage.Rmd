---
title: "Get_taxonomic_coverage â˜º"
output:
  md_document:
    variant: markdown_github
---
# Get taxonomic coverage

Our aim is get the taxonomic coverage. First of all, we read our file within all the records (30324), `raw_data_from_linaria_corregida.csv`. This archive is located in the folder `db`. Then, we select the 'id', 'nombre_cientifico' and 'id_dicc_especies' variables.

At the same time, we get the taxonomy coverage only of the order Passeriformes, because we will use only these data for our dp. We get the families and genus of Passeriformes. 

```{r}
#di <- '/Users/ajpelu/ownCloud/MS/MS_DP_DISPERSANTES/dp_dispersantes'

di <- '/Users/iecolab/Documents/Lola/dp_dispersantes'

# Read the archive of the species records
registros <- read.csv(file=paste(di,"/db/raw_data_from_linaria_corregida.csv", sep=""), header=TRUE, sep=";")
reg <- registros[,c('id','nombre_cientifico','id_dicc_especies')]

# Leo datos de cobertura taxonomica (incluir enlace)
taxonomy <- read.csv(file=paste(di,"/data/taxonomy.csv", sep=""), header=TRUE, sep=",")
```

Join the records of the species with the taxonomy data. 

```{r}
library('plyr')
df <- join(reg, taxonomy, by='id_dicc_especies')
```

Get the taxonomic coverage. We get the number of records of each taxonomy rank and the percentage to total records. Finally, we save the results as a `.csv` in the folder `/data/taxo_coverage_output`.

```{r}
# Orden
orden <- aggregate(df$id, by=list(df$order), length)
names(orden) <- c('Order','records')

orden$per <- round((orden$records/sum(orden$records)*100),2)

#Test that we have 30324 records. 
sum(orden$records)
              
write.csv(orden, file = paste(di,"/data/taxo_coverage_output/orden_cov.csv", sep=""), row.names=FALSE, quote= FALSE)
```

```{r}
# Family
family <- aggregate(df$id, by=list(df$family), length)
names(family) <- c('Family','records')

family$per <- round((family$records/sum(family$records)*100),2)

#Test that we have 30324 records. 
sum(family$records)
              
write.csv(family, file = paste(di,"/data/taxo_coverage_output/family_cov.csv", sep=""), row.names=FALSE, quote= FALSE)


# Families of Passeriformes. 

#en df tenemos todos los registros. Queremos coger solo aquellos en los que el orden sea passeriformes. 
dfpasser <- subset(df,order=="Passeriformes")
familypasser <- aggregate(dfpasser$id, by=list(dfpasser$family), length)
names(familypasser) <- c('Family','records')

familypasser$per <- round((familypasser$records/sum(familypasser$records)*100),2)

#Test that we have 28437 records. 
sum(familypasser$records)
              
write.csv(familypasser, file = paste(di,"/data/taxo_coverage_output/passerfamily_cov.csv", sep=""), row.names=FALSE, quote= FALSE)

familypasser 
```

```{r}
# Genus
genus <- aggregate(df$id, by=list(df$genus), length)
names(genus) <- c('Genus','records')

genus$per <- round((genus$records/sum(genus$records)*100),2)

#Test that we have 28437 records. 
sum(genus$records)
              
write.csv(genus, file = paste(di,"/data/taxo_coverage_output/genus_cov.csv", sep=""), row.names=FALSE, quote= FALSE, sep="")


# Genus of Passeriformes. 

genuspasser <- aggregate(dfpasser$id, by=list(dfpasser$genus), length)
names(genuspasser) <- c('Genus','records')

genuspasser$per <- round((genuspasser$records/sum(genuspasser$records)*100),2)

#Test that we have 28437 records. 
sum(genuspasser$records)
              
write.csv(family, file = paste(di,"/data/taxo_coverage_output/passergenus_cov.csv", sep=""), row.names=FALSE, quote= FALSE)

genuspasser 
```


